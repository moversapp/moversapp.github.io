<!DOCTYPE html>
<html>
<title>Movers</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
<link rel="stylesheet" href="./styles.css">
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
<script>
	var launched=false;
	function ValidateEmail(mail, doAlert)
	{
		if (/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(mail) && mail != 'email@example.it')
		{
			return (true)
		}
		if(doAlert)
			alert("You have entered an invalid email address!")
		return (false)
	}
	
	function jQ_fitVid(ref, target) {
		var ref_h = ref.outerHeight();
		var ref_w = target.outerWidth();
		var window_w = $(window).outerWidth();
		var aspect_ratio = window_w/$(window).outerHeight();
		if (window_w >= 1200) {
			var target_h = ref_w/aspect_ratio;
			if (target_h > ref_h) {
				var margin_top = (target_h-ref_h)/2;
				ref.css('margin-top',margin_top);
				$("#video > iframe").height(target_h);
			} else {
				ref.css('margin-top', 0);
				$("#video > iframe").height(ref_h);
			}
		} else {
			var aspect_ratio = window_w/$(window).height();
			var target_h = ref_w/aspect_ratio;
			$("#video > iframe").height(target_h);
		}
	}
</script>
<body>
<div class="bgcolor">
	<!-- Logo -->
	<div id="logo" class="row">
		<div class="col"></div>
		<div></div>
		<div class="col"></div>
	</div>
	<!-- Content -->
	<div class="margin-top-large">
		<div class="row no-margin">
			<div class="col-0 col-xl-1"></div>
			<div class="col-12 col-xl-10 no-padding">
				<div class="row no-margin">
					<!-- Description -->
					<div class="col-12 col-xl-5">
						<div style="height: auto;" id="ref">
							<h1>Mobility designed for humans</h1>
							<p align="justify">Quante volte hai pensato che sarebbe comodo avere un tram diretto che dalla fermata sotto casa ti porti davanti all’ufficio?</p>
							<p align="justify">Noi non possiamo fare questo. Stiamo però sviluppando <b>un’applicazione che impara le tue abitudini di mobilità e ti propone un abbonamento integrato tra mezzi pubblici e servizi di mobilità condivisa</b> (monopattini, bici e molto altro).</p>
							<p align="justify">Basandosi sul tuo abbonamento, l’applicazione ti suggerirà sempre il percorso più veloce per muoverti, e sarà come avere una linea di tram fatta su misura per te!</p>
							<p align="justify">Se l'idea ti sembra interessante, guarda il video per scoprire come funziona!</p>
						</div>
					</div>
					<div class="col-0 col-xl-1"></div>
					<!-- Video -->
					<div class="col-12 col-xl-6">
						<div id="video">
							<iframe width="300" height="300" src="https://www.youtube-nocookie.com/embed/lTKCADdk_nQ?rel=0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
						</div>
					</div>
				</div>
			</div>
			<div class="col-0 col-md-1"></div>
		</div>
		<!-- Newsletter -->
		<div class="row margin-top-medium margin-bottom-medium no-margin">
			<div class="col"></div>
			<div class="col-auto">
				<div class="full-width">
					<p class="font-small no-padding no-margin" align="center">Mostraci il tuo supporto, iscriviti alla newsletter</p>
					<p class="font-small no-padding no-margin" align="center">Ti invieremo aggiornamenti su Movers</p>
				</div>
				<div class="full-width">
					<div class="row no-margin full-width margin-top-small">
						<div class="col-12 col-md-8 no-padding">
							<input type="email" id="user-email" class="full-width font-medium padding-small"></input>
						</div>
						<div class="col-12 col-md-4 no-padding-right">
							<input type="button" id="subscribe" class="full-width font-small" value="Iscrivimi"></input>
						</div>	
					</div>
				</div>
			</div>
			<div class="col"></div>
		</div>
	</div>
</div>
<script>
		$('body').ready(function() {
			$('#user-email').val('email@example.it');
			$('#user-email').focusin(function() {
				if (!ValidateEmail($('#user-email').val(), false))
					$('#user-email').val('');
			});
			$('#user-email').focusout(function() {
				if (!ValidateEmail($('#user-email').val(), false))
					$('#user-email').val('email@example.it');
			});
			jQ_fitVid($('#ref'), $('#video'));
			$(window).resize(function() {
				jQ_fitVid($('#ref'), $('#video'));
			});
			$('#user-email').keypress(function(event) {
				var mail = $('#user-email').val();
				var d = {"email_address": mail, "status": 'subscribed'};
				if(event.which == 13 && !launched) {
					if(ValidateEmail(mail, true)) {
						launched = true;
						//subscribe
						$.ajax({
							url: 'https://cors-anywhere.herokuapp.com/https://us10.api.mailchimp.com/3.0/lists/2437d91daf/members/',
							type: 'post',
							data:
								JSON.stringify(d),
							headers: {
								Authorization: 'apikey 9d8006a2a37be0bc976ee931625e3f1e-us10'
							},
							dataType: 'json',
							success: function (data) {
								$('#user-email').val('Registrato');
								$('#user-email').prop( "disabled", true );
								alert('Welcome ' + mail);
							},
							error: function(XMLHttpRequest, textStatus, errorThrown) {
								alert("Errore, riprova!");
							}
						});
					} else {
						$('#user-email').val('');
					}
				} else
					launched = false;
			});
			$('#subscribe').click(function() {
				var mail = $('#user-email').val();
				var d = {"email_address": mail, "status": 'subscribed'};
				if(ValidateEmail(mail, true)) {
					launched = true;
					//subscribe
					$.ajax({
						url: 'https://cors-anywhere.herokuapp.com/https://us10.api.mailchimp.com/3.0/lists/2437d91daf/members/',
						type: 'post',
						data:
							JSON.stringify(d),
						headers: {
							Authorization: 'apikey 9d8006a2a37be0bc976ee931625e3f1e-us10'
						},
						dataType: 'json',
						success: function (data) {
							$('#user-email').val('Registrato');
							$('#user-email').prop( "disabled", true );
							alert('Welcome ' + mail);
						},
						error: function(XMLHttpRequest, textStatus, errorThrown) {
							alert("Errore, riprova!");
						}
					});
				} else {
					$('#user-email').val('');
				}
			});
		});
	</script>
</body>
</html>
